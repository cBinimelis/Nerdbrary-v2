@page "/Animes/edit"
@page "/Animes/edit/{Id_Anime:int}"
@inject IAnimeData aniData
@inject IGeneroAnimeData generoAnimeData
@inject NavigationManager NavigationManager


<div class="container">
    <!--Comprobar si se está editando o creando un elemento, para saber que informacion mostrar-->
    @if (Id_Anime is null)
    {
        <PageTitle>Agregar un nuevo anime</PageTitle>
        <h1>Agregar un nuevo anime</h1>
    }
    else
    {
        <PageTitle>Editar "@CurrentAnime.Nombre"</PageTitle>
        <h1>Editar "@CurrentAnime.Nombre"</h1>
    }

    <div class="p-4"></div>

    <div class="row">
        <EditForm Model="CurrentAnime" OnSubmit="HandleSubmit" FormName="AnimeForm">
            <div class="row">
                <div class="col col-md-4 col-md-offset-4">
                    <!-- Text input-->
                    <div class="form-group">
                        <label for="name">Nombre</label>
                        <InputText id="name" @bind-Value="CurrentAnime.Nombre" class="form-control" />
                    </div>

                    <!-- Select input-->
                    <div class="form-group">
                        <label class="control-label" for="selectinput">Genero:</label>
                        <InputSelect class="form-control" id="selectinput" @bind-Value="CurrentAnime.IdGeneroAnime">
                            <option value="">Genero Anime...</option>
                            @if (generoAnime != null)
                            {
                                @foreach (var genero in generoAnime)
                                {
                                    <option value="@genero.IdGeneroAnime">@genero.Descripcion</option>
                                }
                            }
                        </InputSelect>
                    </div>

                    <!-- Text input-->
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="otrostgeneros">Otros:</label>
                        <InputText id="otrostgeneros" @bind-Value="CurrentAnime.OtrosGeneros" class="form-control" />
                    </div>

                    <!-- Text input-->
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="lanzamiento">Estreno:</label>
                        <InputDate id="lanzamiento" @bind-Value="CurrentAnime.Lanzamiento" class="form-control" />
                    </div>

                    <!-- Text input-->
                    <div class="form-group">
                        <div class="row">
                            <div class="col">
                                <label class="control-label" for="capitulos">Capítulos:</label>
                                <InputNumber id="capitulos" @bind-Value="CurrentAnime.CapitulosTotales" class="form-control" />
                            </div>
                            <div class="col">
                                <label class="control-label" for="temporadas">Temporadas:</label>
                                <InputNumber id="temporadas" @bind-Value="CurrentAnime.Temporadas" class="form-control" />
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="pt-3">
                            <button type="" @onclick="@(() => Delete(CurrentAnime.IdAnime))" class="btn btn-outline-danger w-25">Eliminar</button>
                            <button type="" @onclick="@(() => BackToAnime())" class="btn btn-outline-primary w-auto">Cancelar</button>
                            <button type="submit" class="btn btn-primary w-50">Guardar</button>
                        </div>
                    </div>
                </div>
                <div class="col col-md-8 col-md-offset-8">
                    <label class="control-label" for="textinput">Sinopsis</label>
                    <div>
                        <InputTextArea @bind-Value="CurrentAnime.Sinopsis" class="form-control" style="height: 350px"></InputTextArea>
                    </div>
                </div>
            </div>
        </EditForm>
    </div>
</div>
<div class="container p-2">
    <img id="preview" class="img-fluid" src="img/anime/@CurrentAnime.Imagen " alt="Vista previa de la imagen" />
</div>

@code {
    [Parameter]
    public int? Id_Anime { get; set; }

    [SupplyParameterFromForm]
    public Anime CurrentAnime { get; set; } = new();

    List<GeneroAnime> generoAnime;

    protected override async Task OnInitializedAsync()
    {
        generoAnime = await generoAnimeData.GetAllGeneroAnimeAsync();
    }

    protected override async Task OnParametersSetAsync()
    {
        if (Id_Anime is not null)
        {
            var anime = await aniData.GetAnimeAsync((int)Id_Anime);
            if (anime is not null)
            {
                CurrentAnime = anime;
            }
        }
    }

    void HandleSubmit()
    {

    }

    void Delete(int id)
    {

    }

    void BackToAnime()
    {
        NavigationManager.NavigateTo("/Animes");
    }
}